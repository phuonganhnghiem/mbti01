<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫Øc nghi·ªám t√≠nh c√°ch MBTI - AI Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f3f4f6;
        }
        .option-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .option-card:hover {
            transform: translateY(-2px);
            border-color: #93c5fd;
        }
        .option-card:active {
            transform: scale(0.98);
        }
        .option-card.selected {
            border-color: #2563eb;
            background-color: #eff6ff;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.1), 0 2px 4px -1px rgba(37, 99, 235, 0.06);
        }
        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        .slide-up {
            animation: slideUp 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Typing effect cursor */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-blue-50 to-indigo-100">

    <!-- Container -->
    <div class="bg-white w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden min-h-[500px] flex flex-col relative transition-all duration-300" id="mainContainer">
        
        <!-- Header -->
        <header class="bg-white px-6 pt-6 pb-2 text-center border-b border-gray-100 flex justify-between items-center">
            <div class="text-left">
                <h1 class="text-xl font-bold text-gray-800 tracking-tight">MBTI Test <span class="text-blue-600 text-sm font-normal bg-blue-50 px-2 py-0.5 rounded-full ml-1">AI Analytics</span></h1>
            </div>
            <div class="text-sm text-gray-400" id="questionCounter"></div>
        </header>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-100 h-1.5">
            <div id="progressBar" class="bg-blue-600 h-1.5 transition-all duration-300 ease-out" style="width: 0%"></div>
        </div>

        <!-- Content Area -->
        <main class="flex-grow p-6 md:p-10 flex flex-col justify-center relative" id="app">
            <!-- JavaScript will render content here -->
        </main>

        <!-- Footer -->
        <footer class="bg-gray-50 p-3 text-center text-gray-400 text-xs border-t flex justify-between px-6">
            <span>&copy; 2024 MBTI AI</span>
            <span id="categoryLabel" class="font-medium text-gray-500"></span>
        </footer>
    </div>

    <!-- Logic Script -->
    <script>
        // --- DATA ---
        // Flattened structure for single-question flow
        const allQuestions = [
            // Ph·∫ßn 1 (E/I)
            { id: 1, a: "T√¥i th√≠ch giao l∆∞u, th·∫£o lu·∫≠n nh√≥m", b: "T√¥i th√≠ch l√†m vi·ªác ƒë·ªôc l·∫≠p, y√™n tƒ©nh", typeA: "E", typeB: "I", category: "NƒÉng l∆∞·ª£ng" },
            { id: 2, a: "T√¥i d·ªÖ b·∫Øt chuy·ªán v·ªõi ng∆∞·ªùi m·ªõi", b: "T√¥i c·∫ßn th·ªùi gian ƒë·ªÉ l√†m quen", typeA: "E", typeB: "I", category: "NƒÉng l∆∞·ª£ng" },
            { id: 3, a: "T√¥i c·∫£m th·∫•y ‚Äún·∫°p nƒÉng l∆∞·ª£ng‚Äù khi ·ªü n∆°i ƒë√¥ng ng∆∞·ªùi", b: "T√¥i th·∫•y ‚Äúx·∫£ stress‚Äù khi ·ªü m·ªôt m√¨nh", typeA: "E", typeB: "I", category: "NƒÉng l∆∞·ª£ng" },
            { id: 4, a: "T√¥i th∆∞·ªùng b·ªôc l·ªô suy nghƒ© ra ngo√†i", b: "T√¥i th∆∞·ªùng suy nghƒ© k·ªπ tr∆∞·ªõc khi n√≥i", typeA: "E", typeB: "I", category: "NƒÉng l∆∞·ª£ng" },
            { id: 5, a: "T√¥i h·ªçc t·ªët nh·∫•t khi l√†m c√πng ng∆∞·ªùi kh√°c", b: "T√¥i h·ªçc t·ªët nh·∫•t khi t·ª± h·ªçc, t·ª± nghi√™n c·ª©u", typeA: "E", typeB: "I", category: "NƒÉng l∆∞·ª£ng" },
            // Ph·∫ßn 2 (S/N)
            { id: 6, a: "T√¥i t·∫≠p trung v√†o s·ª± ki·ªán, d·ªØ ki·ªán c·ª• th·ªÉ", b: "T√¥i quan t√¢m ƒë·∫øn √Ω t∆∞·ªüng v√† kh·∫£ nƒÉng ti·ªÅm t√†ng", typeA: "S", typeB: "N", category: "Th√¥ng tin" },
            { id: 7, a: "T√¥i th√≠ch quy tr√¨nh r√µ r√†ng, t·ª´ng b∆∞·ªõc m·ªôt", b: "T√¥i th√≠ch s√°ng t·∫°o v√† kh√°m ph√° ph∆∞∆°ng √°n m·ªõi", typeA: "S", typeB: "N", category: "Th√¥ng tin" },
            { id: 8, a: "T√¥i tin v√†o kinh nghi·ªám th·ª±c t·∫ø", b: "T√¥i tin v√†o tr·ª±c gi√°c v√† c·∫£m nh·∫≠n c√° nh√¢n", typeA: "S", typeB: "N", category: "Th√¥ng tin" },
            { id: 9, a: "T√¥i hay ƒë·ªÉ √Ω ƒë·∫øn chi ti·∫øt nh·ªè", b: "T√¥i nh√¨n v√†o b·ª©c tranh t·ªïng th·ªÉ", typeA: "S", typeB: "N", category: "Th√¥ng tin" },
            { id: 10, a: "T√¥i th√≠ch nh·ªØng g√¨ c√≥ th·ªÉ ƒëo l∆∞·ªùng", b: "T√¥i h·ª©ng th√∫ v·ªõi nh·ªØng g√¨ ‚Äúc√≥ th·ªÉ x·∫£y ra‚Äù trong t∆∞∆°ng lai", typeA: "S", typeB: "N", category: "Th√¥ng tin" },
            // Ph·∫ßn 3 (T/F)
            { id: 11, a: "T√¥i ra quy·∫øt ƒë·ªãnh d·ª±a tr√™n l√Ω tr√≠, logic", b: "T√¥i c√¢n nh·∫Øc c·∫£m x√∫c, t√°c ƒë·ªông ƒë·∫øn con ng∆∞·ªùi", typeA: "T", typeB: "F", category: "Quy·∫øt ƒë·ªãnh" },
            { id: 12, a: "T√¥i th·∫≥ng th·∫Øn, g√≥p √Ω tr·ª±c ti·∫øp", b: "T√¥i nh·∫π nh√†ng, quan t√¢m c·∫£m x√∫c ng∆∞·ªùi kh√°c", typeA: "T", typeB: "F", category: "Quy·∫øt ƒë·ªãnh" },
            { id: 13, a: "T√¥i ƒë·∫∑t hi·ªáu qu·∫£ l√™n h√†ng ƒë·∫ßu", b: "T√¥i ƒë·∫∑t s·ª± h√†i h√≤a, ƒë·ªìng thu·∫≠n l√™n h√†ng ƒë·∫ßu", typeA: "T", typeB: "F", category: "Quy·∫øt ƒë·ªãnh" },
            { id: 14, a: "T√¥i x·ª≠ l√Ω v·∫•n ƒë·ªÅ nh∆∞ m·ªôt ‚Äúchuy√™n gia‚Äù", b: "T√¥i x·ª≠ l√Ω nh∆∞ m·ªôt ‚Äúng∆∞·ªùi ƒë·ªìng h√†nh‚Äù", typeA: "T", typeB: "F", category: "Quy·∫øt ƒë·ªãnh" },
            { id: 15, a: "T√¥i th√≠ch m√¥i tr∆∞·ªùng c·∫°nh tranh, ƒë√°nh gi√° k·∫øt qu·∫£", b: "T√¥i th√≠ch m√¥i tr∆∞·ªùng g·∫Øn k·∫øt, h·ªó tr·ª£ l·∫´n nhau", typeA: "T", typeB: "F", category: "Quy·∫øt ƒë·ªãnh" },
            // Ph·∫ßn 4 (J/P)
            { id: 16, a: "T√¥i l√™n k·∫ø ho·∫°ch r√µ r√†ng, l√†m vi·ªác theo ti·∫øn tr√¨nh", b: "T√¥i linh ho·∫°t, ph·∫£n ·ª©ng theo t√¨nh hu·ªëng", typeA: "J", typeB: "P", category: "T·ªï ch·ª©c" },
            { id: 17, a: "T√¥i th√≠ch k·∫øt lu·∫≠n nhanh, ƒë√≥ng khung v·∫•n ƒë·ªÅ", b: "T√¥i th√≠ch m·ªü r·ªông, kh√°m ph√° nhi·ªÅu kh·∫£ nƒÉng", typeA: "J", typeB: "P", category: "T·ªï ch·ª©c" },
            { id: 18, a: "T√¥i th∆∞·ªùng tu√¢n th·ªß th·ªùi h·∫°n nghi√™m t√∫c", b: "T√¥i c√≥ xu h∆∞·ªõng tr√¨ ho√£n n·∫øu ch∆∞a c·∫ßn g·∫•p", typeA: "J", typeB: "P", category: "T·ªï ch·ª©c" },
            { id: 19, a: "T√¥i th·∫•y h√†i l√≤ng khi m·ªçi vi·ªác ƒë∆∞·ª£c t·ªï ch·ª©c ch·∫∑t ch·∫Ω", b: "T√¥i th·∫•y tho·∫£i m√°i khi ƒë∆∞·ª£c t·ª± do quy·∫øt ƒë·ªãnh", typeA: "J", typeB: "P", category: "T·ªï ch·ª©c" },
            { id: 20, a: "T√¥i th√≠ch ‚Äúƒë√≥ng vi·ªác‚Äù h∆°n l√† ‚Äúm·ªü vi·ªác‚Äù", b: "T√¥i th√≠ch ƒë·ªÉ m·ªçi th·ª© ‚Äúm·ªü‚Äù, c√≥ th·ªÉ thay ƒë·ªïi", typeA: "J", typeB: "P", category: "T·ªï ch·ª©c" }
        ];

        const typeBaseInfo = {
            "ISTJ": { title: "Ng∆∞·ªùi Tr√°ch Nhi·ªám", role: "Nh√† qu·∫£n l√Ω", traits: ["Th·ª±c t·∫ø", "C√≥ t·ªï ch·ª©c", "ƒê√°ng tin c·∫≠y"] },
            "ISFJ": { title: "Ng∆∞·ªùi Nu√¥i D∆∞·ª°ng", role: "Ng∆∞·ªùi b·∫£o v·ªá", traits: ["T·∫≠n t·ª•y", "√Çn c·∫ßn", "Ki√™n nh·∫´n"] },
            "INFJ": { title: "Ng∆∞·ªùi Che Ch·ªü", role: "Nh√† t∆∞ v·∫•n", traits: ["S√¢u s·∫Øc", "S√°ng t·∫°o", "T·∫ßm nh√¨n"] },
            "INTJ": { title: "Nh√† Ki·∫øn T·∫°o", role: "Nh√† chi·∫øn l∆∞·ª£c", traits: ["Logic", "ƒê·ªôc l·∫≠p", "Quy·∫øt ƒëo√°n"] },
            "ISTP": { title: "Th·ª£ Th·ªß C√¥ng", role: "Nh√† k·ªπ thu·∫≠t", traits: ["Linh ho·∫°t", "Th·ª±c t·∫ø", "Kh√©o l√©o"] },
            "ISFP": { title: "Ng∆∞·ªùi Ngh·ªá Sƒ©", role: "Nh√† phi√™u l∆∞u", traits: ["√în h√≤a", "Nh·∫°y c·∫£m", "Tinh t·∫ø"] },
            "INFP": { title: "Ng∆∞·ªùi H√≤a Gi·∫£i", role: "Nh√† l√Ω t∆∞·ªüng", traits: ["Trung th√†nh", "Th·∫•u c·∫£m", "S√°ng t·∫°o"] },
            "INTP": { title: "Nh√† T∆∞ Duy", role: "Nh√† logic h·ªçc", traits: ["T√≤ m√≤", "Ph√¢n t√≠ch", "Tr·ª´u t∆∞·ª£ng"] },
            "ESTP": { title: "Ng∆∞·ªùi Th·ª±c Thi", role: "Nh√† kh·ªüi x∆∞·ªõng", traits: ["NƒÉng ƒë·ªông", "Th·ª±c d·ª•ng", "M·∫°o hi·ªÉm"] },
            "ESFP": { title: "Ng∆∞·ªùi Tr√¨nh Di·ªÖn", role: "Ng∆∞·ªùi gi·∫£i tr√≠", traits: ["Vui v·∫ª", "Nhi·ªát t√¨nh", "T·ª± ph√°t"] },
            "ENFP": { title: "Ng∆∞·ªùi Truy·ªÅn C·∫£m H·ª©ng", role: "Nh√† v·∫≠n ƒë·ªông", traits: ["S√°ng t·∫°o", "Nhi·ªát huy·∫øt", "T·ª± do"] },
            "ENTP": { title: "Ng∆∞·ªùi Nh√¨n Xa", role: "Ng∆∞·ªùi tranh lu·∫≠n", traits: ["Th√¥ng minh", "Linh ho·∫°t", "Th√°ch th·ª©c"] },
            "ESTJ": { title: "Ng∆∞·ªùi Gi√°m S√°t", role: "Nh√† ƒëi·ªÅu h√†nh", traits: ["Quy·∫øt ƒëo√°n", "Hi·ªáu qu·∫£", "H·ªá th·ªëng"] },
            "ESFJ": { title: "Ng∆∞·ªùi Quan T√¢m", role: "Ng∆∞·ªùi cung c·∫•p", traits: ["H√≤a ƒë·ªìng", "T·∫≠n t·ª•y", "H·ª£p t√°c"] },
            "ENFJ": { title: "Ng∆∞·ªùi Ch·ªâ D·∫´n", role: "Nh√† gi√°o", traits: ["Thu h√∫t", "Th·∫•u hi·ªÉu", "L√£nh ƒë·∫°o"] },
            "ENTJ": { title: "Nh√† ƒêi·ªÅu H√†nh", role: "Nh√† ch·ªâ huy", traits: ["Chi·∫øn l∆∞·ª£c", "Tham v·ªçng", "M·∫°nh m·∫Ω"] }
        };

        // State
        let currentIdx = 0;
        let answers = {}; // { id: 'A' | 'B' }
        const app = document.getElementById('app');
        const progressBar = document.getElementById('progressBar');
        const questionCounter = document.getElementById('questionCounter');
        const categoryLabel = document.getElementById('categoryLabel');

        // --- CORE FUNCTIONS ---

        function renderWelcome() {
            questionCounter.innerText = "";
            categoryLabel.innerText = "";
            progressBar.style.width = "0%";
            
            app.innerHTML = `
                <div class="text-center space-y-8 fade-in py-4">
                    <div class="relative inline-block">
                        <div class="absolute inset-0 bg-blue-200 blur-xl rounded-full opacity-50"></div>
                        <div class="bg-white p-6 rounded-2xl shadow-sm relative border border-blue-100">
                            <i class="fa-solid fa-clipboard-list text-5xl text-blue-600"></i>
                        </div>
                    </div>
                    
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">H∆∞·ªõng d·∫´n</h2>
                        
                        <div class="space-y-4 max-w-lg mx-auto text-left bg-blue-50 p-6 rounded-xl border border-blue-100 shadow-sm">
                             <ul class="list-disc pl-5 space-y-3 text-gray-700 font-medium">
                                <li>V·ªõi m·ªói c·∫∑p c√¢u h·ªèi, h√£y ch·ªçn 1 c√¢u m√¥ t·∫£ b·∫°n ƒë√∫ng h∆°n trong ph·∫ßn l·ªõn t√¨nh hu·ªëng c√¥ng vi·ªác h√†ng ng√†y.</li>
                                <li>Kh√¥ng c√≥ ƒë√∫ng sai, ch·ªâ c√≥ s·ª± ph√π h·ª£p v·ªõi b·∫£n th√¢n b·∫°n.</li>
                            </ul>
                        </div>
                    </div>

                    <button onclick="startQuiz()" class="group relative inline-flex h-12 items-center justify-center overflow-hidden rounded-full bg-blue-600 px-8 font-medium text-white shadow-lg transition-all duration-300 hover:bg-blue-700 hover:w-48 w-40 hover:shadow-blue-500/30">
                        <span class="mr-2">B·∫Øt ƒë·∫ßu</span>
                        <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                    </button>
                </div>
            `;
        }

        function startQuiz() {
            currentIdx = 0;
            answers = {};
            renderQuestion();
        }

        function renderQuestion() {
            if (currentIdx >= allQuestions.length) {
                showProcessing();
                return;
            }

            const q = allQuestions[currentIdx];
            const progress = ((currentIdx) / allQuestions.length) * 100;
            
            progressBar.style.width = `${progress}%`;
            questionCounter.innerText = `${currentIdx + 1}/${allQuestions.length}`;
            // Removed category display as requested
            categoryLabel.innerText = ""; 

            // Fade out current content first (optional, simplistic replace here)
            app.innerHTML = `
                <div class="flex flex-col h-full justify-center space-y-8 slide-up">
                    <h2 class="text-center text-gray-400 text-sm font-semibold tracking-wider uppercase mb-2">C√¢u h·ªèi ${currentIdx + 1}</h2>
                    
                    <div class="grid gap-4">
                        <!-- Option A -->
                        <button onclick="handleSelect('${q.id}', 'A')" class="option-card group relative w-full p-6 text-left bg-white border-2 border-gray-100 rounded-xl hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <div class="flex items-center justify-between">
                                <span class="text-lg text-gray-700 font-medium group-hover:text-blue-700 transition-colors">${q.a}</span>
                                <div class="w-6 h-6 rounded-full border-2 border-gray-200 flex items-center justify-center group-hover:border-blue-400">
                                    <div class="w-3 h-3 rounded-full bg-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                </div>
                            </div>
                        </button>

                        <!-- Option B -->
                        <button onclick="handleSelect('${q.id}', 'B')" class="option-card group relative w-full p-6 text-left bg-white border-2 border-gray-100 rounded-xl hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <div class="flex items-center justify-between">
                                <span class="text-lg text-gray-700 font-medium group-hover:text-blue-700 transition-colors">${q.b}</span>
                                <div class="w-6 h-6 rounded-full border-2 border-gray-200 flex items-center justify-center group-hover:border-blue-400">
                                    <div class="w-3 h-3 rounded-full bg-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                </div>
                            </div>
                        </button>
                    </div>

                    ${currentIdx > 0 ? `
                        <div class="text-center mt-4">
                            <button onclick="prevQuestion()" class="text-gray-400 hover:text-gray-600 text-sm font-medium transition-colors">
                                <i class="fa-solid fa-arrow-left mr-1"></i> Quay l·∫°i c√¢u tr∆∞·ªõc
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function handleSelect(qId, value) {
            answers[qId] = value;
            
            // Visual feedback - highlight selected temporarily
            const buttons = document.querySelectorAll('.option-card');
            // Simply disable to prevent double clicks
            buttons.forEach(b => b.classList.add('pointer-events-none'));
            
            // Short delay before moving to next
            setTimeout(() => {
                currentIdx++;
                renderQuestion();
            }, 250);
        }

        function prevQuestion() {
            if (currentIdx > 0) {
                currentIdx--;
                renderQuestion();
            }
        }

        function showProcessing() {
            progressBar.style.width = "100%";
            questionCounter.innerText = "";
            categoryLabel.innerText = "ƒêANG X·ª¨ L√ù";
            
            app.innerHTML = `
                <div class="flex flex-col items-center justify-center text-center space-y-6 fade-in h-64">
                    <div class="relative">
                        <div class="w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"></div>
                        <i class="fa-solid fa-brain text-blue-600 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">AI ƒëang ph√¢n t√≠ch d·ªØ li·ªáu...</h3>
                        <p class="text-gray-500 text-sm mt-2" id="loadingText">T·ªïng h·ª£p k·∫øt qu·∫£...</p>
                    </div>
                </div>
            `;

            // Simulation steps
            const steps = ["ƒêang t√≠nh to√°n ch·ªâ s·ªë...", "So kh·ªõp m·∫´u t√≠nh c√°ch...", "T·∫°o b√°o c√°o chi ti·∫øt...", "Ho√†n t·∫•t!"];
            let stepIdx = 0;
            const interval = setInterval(() => {
                const el = document.getElementById('loadingText');
                if (el) el.innerText = steps[stepIdx];
                stepIdx++;
                if (stepIdx >= steps.length) {
                    clearInterval(interval);
                    calculateAndShowResult();
                }
            }, 800);
        }

        function generateAIAnalysis(scores, type) {
            // Helper to determine strength
            const getStrength = (val1, val2) => {
                const total = val1 + val2;
                const percentage = (Math.max(val1, val2) / total) * 100;
                if (percentage > 90) return "tuy·ªát ƒë·ªëi";
                if (percentage > 75) return "r√µ r·ªát";
                if (percentage > 60) return "kh√°";
                return "c√¢n b·∫±ng";
            };

            const eStr = getStrength(scores.E, scores.I);
            const sStr = getStrength(scores.S, scores.N);
            const tStr = getStrength(scores.T, scores.F);
            const jStr = getStrength(scores.J, scores.P);

            let analysis = "";

            // Intro logic
            analysis += `<p class="mb-3">D·ª±a tr√™n d·ªØ li·ªáu, b·∫°n thu·ªôc nh√≥m <strong>${type}</strong>. D∆∞·ªõi ƒë√¢y l√† ph√¢n t√≠ch chuy√™n s√¢u v·ªÅ c·∫•u tr√∫c t√¢m l√Ω c·ªßa b·∫°n:</p>`;

            // E vs I
            if (scores.E > scores.I) {
                analysis += `<p class="mb-2"><strong class="text-blue-600">NƒÉng l∆∞·ª£ng (${eStr}):</strong> B·∫°n l√† ng∆∞·ªùi h∆∞·ªõng ngo·∫°i, t√¨m th·∫•y nƒÉng l∆∞·ª£ng t·ª´ s·ª± t∆∞∆°ng t√°c. ·ªû m·ª©c ƒë·ªô ${eStr}, b·∫°n ${eStr === 'tuy·ªát ƒë·ªëi' ? 'c·ª±c k·ª≥ nƒÉng n·ªï v√† kh√≥ ch·ªãu khi ph·∫£i ·ªü m·ªôt m√¨nh qu√° l√¢u' : 'th√≠ch giao ti·∫øp nh∆∞ng v·∫´n tr√¢n tr·ªçng nh·ªØng kho·∫£ng l·∫∑ng nh·∫•t ƒë·ªãnh'}.</p>`;
            } else {
                analysis += `<p class="mb-2"><strong class="text-blue-600">NƒÉng l∆∞·ª£ng (${eStr}):</strong> B·∫°n l√† ng∆∞·ªùi h∆∞·ªõng n·ªôi, n·∫°p nƒÉng l∆∞·ª£ng t·ª´ th·∫ø gi·ªõi b√™n trong. S·ª± h∆∞·ªõng n·ªôi ${eStr} cho th·∫•y b·∫°n ${eStr === 'r√µ r·ªát' ? 'l√† ng∆∞·ªùi c√≥ chi·ªÅu s√¢u n·ªôi t√¢m l·ªõn v√† ch·ªçn l·ªçc k·ªπ c√°c m·ªëi quan h·ªá' : 'c·∫ßn kh√¥ng gian ri√™ng t∆∞ ƒë·ªÉ suy ng·∫´m sau nh·ªØng gi·ªù l√†m vi·ªác cƒÉng th·∫≥ng'}.</p>`;
            }

            // S vs N
            if (scores.S > scores.N) {
                analysis += `<p class="mb-2"><strong class="text-blue-600">Ti·∫øp nh·∫≠n th√¥ng tin (${sStr}):</strong> B·∫°n ∆∞u ti√™n th·ª±c t·∫ø (Sensing). B·∫°n tin v√†o nh·ªØng g√¨ m·∫Øt th·∫•y tai nghe. C√°ch ti·∫øp c·∫≠n v·∫•n ƒë·ªÅ c·ªßa b·∫°n mang t√≠nh ${sStr === 'kh√°' ? 'th·ª±c ti·ªÖn v√† d·ª±a tr√™n kinh nghi·ªám' : 'c·ª• th·ªÉ, chi ti·∫øt v√† hi·∫øm khi m∆° m·ªông vi·ªÉn v√¥ng'}.</p>`;
            } else {
                analysis += `<p class="mb-2"><strong class="text-blue-600">Ti·∫øp nh·∫≠n th√¥ng tin (${sStr}):</strong> B·∫°n l√† ng∆∞·ªùi tr·ª±c gi√°c (Intuition). B·∫°n nh√¨n th·∫•y b·ª©c tranh l·ªõn v√† c√°c kh·∫£ nƒÉng t∆∞∆°ng lai. T∆∞ duy c·ªßa b·∫°n ${sStr === 'c√¢n b·∫±ng' ? 'c√≥ s·ª± bay b·ªïng nh∆∞ng v·∫´n gi·ªØ ƒë∆∞·ª£c logic' : 'ƒë·∫ßy t√≠nh s√°ng t·∫°o, tr·ª´u t∆∞·ª£ng v√† lu√¥n t√¨m ki·∫øm √Ω nghƒ©a ·∫©n sau s·ª± vi·ªác'}.</p>`;
            }

            // T vs F
            if (scores.T > scores.F) {
                analysis += `<p class="mb-2"><strong class="text-blue-600">Ra quy·∫øt ƒë·ªãnh (${tStr}):</strong> L√Ω tr√≠ (Thinking) l√† kim ch·ªâ nam c·ªßa b·∫°n. B·∫°n ƒë√°nh gi√° m·ªçi vi·ªác d·ª±a tr√™n logic v√† t√≠nh hi·ªáu qu·∫£. B·∫°n ${tStr === 'tuy·ªát ƒë·ªëi' ? 'c√≥ th·ªÉ b·ªã ng∆∞·ªùi kh√°c xem l√† l·∫°nh l√πng nh∆∞ng th·ª±c ch·∫•t r·∫•t c√¥ng b·∫±ng' : 'th∆∞·ªùng kh√°ch quan, th·∫≥ng th·∫Øn nh∆∞ng v·∫´n c·ªë g·∫Øng kh√¥ng l√†m t·ªïn th∆∞∆°ng ng∆∞·ªùi kh√°c'}.</p>`;
            } else {
                analysis += `<p class="mb-2"><strong class="text-blue-600">Ra quy·∫øt ƒë·ªãnh (${tStr}):</strong> C·∫£m x√∫c (Feeling) d·∫´n l·ªëi cho b·∫°n. B·∫°n ƒë∆∞a ra quy·∫øt ƒë·ªãnh d·ª±a tr√™n gi√° tr·ªã nh√¢n vƒÉn v√† s·ª± h√≤a h·ª£p. B·∫°n ${tStr === 'r√µ r·ªát' ? 'l√† ng∆∞·ªùi c·ª±c k·ª≥ th·∫•u c·∫£m v√† lu√¥n ƒë·∫∑t con ng∆∞·ªùi l√™n tr√™n quy tr√¨nh' : 'bi·∫øt c√¢n b·∫±ng gi·ªØa l√Ω v√† t√¨nh, nh∆∞ng tr√°i tim th∆∞·ªùng th·∫Øng th·∫ø'}.</p>`;
            }

            // J vs P
            if (scores.J > scores.P) {
                analysis += `<p class="mb-2"><strong class="text-blue-600">Phong c√°ch s·ªëng (${jStr}):</strong> B·∫°n s·ªëng c√≥ nguy√™n t·∫Øc (Judging). S·ª± ngƒÉn n·∫Øp ${jStr} c·ªßa b·∫°n th·ªÉ hi·ªán qua vi·ªác ${jStr === 'r√µ r·ªát' ? 'b·∫°n lu√¥n c√≥ k·∫ø ho·∫°ch B cho m·ªçi t√¨nh hu·ªëng v√† gh√©t s·ª± thay ƒë·ªïi ph√∫t ch√≥t' : 'b·∫°n th√≠ch m·ªçi th·ª© ƒë∆∞·ª£c ch·ªët l·∫°i r√µ r√†ng ƒë·ªÉ an t√¢m th·ª±c hi·ªán'}.</p>`;
            } else {
                analysis += `<p class="mb-2"><strong class="text-blue-600">Phong c√°ch s·ªëng (${jStr}):</strong> B·∫°n linh ho·∫°t (Perceiving). B·∫°n th√≠ch ƒë·ªÉ m·ªçi th·ª© m·ªü v√† t√πy c∆° ·ª©ng bi·∫øn. S·ª± t·ª± do n√†y gi√∫p b·∫°n ${jStr === 'tuy·ªát ƒë·ªëi' ? 'c·ª±c k·ª≥ gi·ªèi xoay s·ªü trong kh·ªßng ho·∫£ng v√† gh√©t s·ª± r√†ng bu·ªôc' : 'd·ªÖ d√†ng th√≠ch nghi v·ªõi m√¥i tr∆∞·ªùng m·ªõi v√† lu√¥n t√¨m th·∫•y ni·ªÅm vui trong s·ª± b·∫•t ng·ªù'}.</p>`;
            }

            // Career Advice (Mock AI)
            analysis += `<div class="mt-4 bg-gray-50 p-3 rounded text-sm text-gray-600 border-l-4 border-purple-500">
                <strong>üí° G·ª£i √Ω ph√°t tri·ªÉn:</strong> V·ªõi t·ªï h·ª£p ${type}, h√£y t·∫≠p trung v√†o m√¥i tr∆∞·ªùng cho ph√©p b·∫°n ph√°t huy t√≠nh ${scores.N > scores.S ? 's√°ng t·∫°o' : 'th·ª±c t·∫ø'} v√† ${scores.J > scores.P ? '·ªïn ƒë·ªãnh' : 't·ª± do'}. ƒê·ª´ng √©p m√¨nh ph·∫£i tr·ªü th√†nh ai kh√°c.
            </div>`;

            return analysis;
        }

        function calculateAndShowResult() {
            let scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };

            allQuestions.forEach(q => {
                const val = answers[q.id];
                if (val === 'A') scores[q.typeA]++;
                else if (val === 'B') scores[q.typeB]++;
            });

            const dim1 = scores.E >= scores.I ? 'E' : 'I';
            const dim2 = scores.S >= scores.N ? 'S' : 'N';
            const dim3 = scores.T >= scores.F ? 'T' : 'F';
            const dim4 = scores.J >= scores.P ? 'J' : 'P';
            
            const type = dim1 + dim2 + dim3 + dim4;
            const info = typeBaseInfo[type];
            
            // Generate AI text
            const aiAnalysisText = generateAIAnalysis(scores, type);

            categoryLabel.innerText = "K·∫æT QU·∫¢";
            progressBar.style.width = "100%";

            app.innerHTML = `
                <div class="fade-in h-full overflow-y-auto pr-2 custom-scrollbar">
                    <!-- Top Result Card -->
                    <div class="text-center mb-8 relative">
                        <div class="inline-block relative">
                            <h1 class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-2">${type}</h1>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">${info.title}</h2>
                        <div class="flex justify-center gap-2 mt-3">
                            ${info.traits.map(t => `<span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-semibold">${t}</span>`).join('')}
                        </div>
                    </div>

                    <!-- AI Analysis Section -->
                    <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm mb-6 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
                        <div class="flex items-center space-x-2 mb-4">
                            <i class="fa-solid fa-robot text-purple-600 text-xl"></i>
                            <h3 class="font-bold text-gray-800 text-lg">Ph√¢n t√≠ch AI</h3>
                        </div>
                        <div class="text-gray-600 text-sm leading-relaxed space-y-2 text-justify">
                            ${aiAnalysisText}
                        </div>
                    </div>

                    <!-- Stats Bars -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                        ${renderStatBar('H∆∞·ªõng ngo·∫°i (E)', scores.E, 'H∆∞·ªõng n·ªôi (I)', scores.I, 'bg-blue-500')}
                        ${renderStatBar('Tr·ª±c gi√°c (N)', scores.N, 'C·∫£m gi√°c (S)', scores.S, 'bg-yellow-500')}
                        ${renderStatBar('L√Ω tr√≠ (T)', scores.T, 'C·∫£m x√∫c (F)', scores.F, 'bg-green-500')}
                        ${renderStatBar('Nguy√™n t·∫Øc (J)', scores.J, 'Linh ho·∫°t (P)', scores.P, 'bg-purple-500')}
                    </div>

                    <div class="flex gap-4 justify-center pb-4">
                        <button onclick="startQuiz()" class="px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-lg transition">
                            <i class="fa-solid fa-rotate-right mr-2"></i>L√†m l·∫°i
                        </button>
                        <button onclick="window.print()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow transition">
                            <i class="fa-solid fa-print mr-2"></i>L∆∞u k·∫øt qu·∫£
                        </button>
                    </div>
                </div>
            `;
        }

        function renderStatBar(label1, val1, label2, val2, colorClass) {
            const total = val1 + val2;
            const pct1 = (val1 / total) * 100;
            const pct2 = (val2 / total) * 100;
            
            return `
                <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                    <div class="flex justify-between text-xs font-bold text-gray-500 mb-1">
                        <span>${label1} (${Math.round(pct1)}%)</span>
                        <span>${label2} (${Math.round(pct2)}%)</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5 flex overflow-hidden">
                        <div class="${colorClass} h-2.5" style="width: ${pct1}%"></div>
                        <div class="bg-gray-300 h-2.5" style="width: ${pct2}%"></div>
                    </div>
                </div>
            `;
        }

        // Init
        renderWelcome();
    </script>
</body>
</html>
